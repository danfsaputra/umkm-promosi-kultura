"use strict";(()=>{var e={};e.id=583,e.ids=[583],e.modules={1416:e=>{e.exports=require("cloudinary")},2087:(e,r,t)=>{t.r(r),t.d(r,{config:()=>_,default:()=>S,routeModule:()=>b});var n={};t.r(n),t.d(n,{config:()=>g,default:()=>I});var a=t(3480),o=t(8667),i=t(6435),s=t(1416),u=t.n(s),d=t(8461),l=t.n(d),c=t(8640);let p=require("mongoose");var f=t.n(p);let P=async()=>{f().connections[0].readyState||await f().connect(process.env.MONGO_URI)},m=new(f()).Schema({nama:{type:String,required:!0},deskripsi:{type:String},harga:{type:Number,required:!0},gambar:{type:String},kategori:{type:String},stok:{type:Number,default:0}},{timestamps:!0}),A=f().models.Product||f().model("Product",m),g={api:{bodyParser:!1}},E=u().v2;E.config({cloud_name:process.env.CLOUDINARY_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let y=new c.CloudinaryStorage({cloudinary:E,params:{folder:"products",allowed_formats:["jpg","jpeg","png"]}}),h=l()({storage:y});function w(e,r,t){return new Promise((n,a)=>{t(e,r,e=>e instanceof Error?a(e):n(e))})}async function I(e,r){if(r.setHeader("Access-Control-Allow-Credentials","true"),r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET,POST,PUT,DELETE,OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type,Authorization"),"OPTIONS"===e.method)return r.status(200).end();await P();try{if("GET"===e.method){let e=await A.find();return r.status(200).json(e)}if("POST"===e.method){await w(e,r,h.single("gambar"));let{nama:t,harga:n,deskripsi:a,stok:o}=e.body,i=e.file?.path,s=new A({nama:t,harga:n,deskripsi:a,stok:o,gambar:i});return await s.save(),r.status(201).json(s)}if("PUT"===e.method){await w(e,r,h.single("gambar"));let{id:t,nama:n,harga:a,deskripsi:o,stok:i}=e.body,s={nama:n,harga:a,deskripsi:o,stok:i};e.file&&(s.gambar=e.file.path);let u=await A.findByIdAndUpdate(t,s,{new:!0});if(!u)return r.status(404).json({error:"Produk tidak ditemukan"});return r.status(200).json(u)}if("DELETE"===e.method){let{id:t}=e.query;if(!await A.findByIdAndDelete(t))return r.status(404).json({error:"Produk tidak ditemukan"});return r.status(200).json({message:"Produk berhasil dihapus"})}return r.status(405).json({error:`Method ${e.method} tidak diizinkan`})}catch(e){return console.error("API Error:",e),r.status(500).json({error:"Internal Server Error",detail:e.message})}}let S=(0,i.M)(n,"default"),_=(0,i.M)(n,"config"),b=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/products",pathname:"/api/products",bundlePath:"",filename:""},userland:n})},3480:(e,r,t)=>{e.exports=t(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8461:e=>{e.exports=require("multer")},8640:e=>{e.exports=require("multer-storage-cloudinary")},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=2087);module.exports=t})();